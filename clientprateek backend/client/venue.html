<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Venue Management | Concert System</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <style>
    :root {
      --primary: #7c4dff;
      --primary-light: #e8e1ff;
      --secondary: #ff4081;
      --text-dark: #333;
      --text-light: #666;
      --white: #fff;
      --gray-light: #f5f5f5;
      --gray: #e0e0e0;
      --success: #4caf50;
      --error: #f44336;
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: 'Segoe UI', Roboto, 'Helvetica Neue', sans-serif;
      color: var(--text-dark);
      background-color: #f9f9f9;
      line-height: 1.6;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 20px;
    }
    
    header {
      background: linear-gradient(135deg, var(--primary), #5e35b1);
      color: var(--white);
      padding: 2rem 0;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    
    .header-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .logo {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 1.5rem;
      font-weight: 700;
    }
    
    .logo i {
      font-size: 2rem;
    }
    
    nav ul {
      display: flex;
      list-style: none;
      gap: 20px;
    }
    
    nav a {
      color: var(--white);
      text-decoration: none;
      padding: 5px 10px;
      border-radius: 4px;
      transition: all 0.3s ease;
    }
    
    nav a:hover, nav a.active {
      background-color: rgba(255,255,255,0.2);
    }
    
    .page-title {
      margin: 1.5rem 0;
      font-size: 2rem;
      position: relative;
      display: inline-block;
    }
    
    .page-title::after {
      content: '';
      position: absolute;
      bottom: -5px;
      left: 0;
      width: 50px;
      height: 3px;
      background-color: var(--secondary);
    }
    
    .card {
      background-color: var(--white);
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      margin-bottom: 1.5rem;
      overflow: hidden;
    }
    
    .card-header {
      background-color: var(--primary-light);
      padding: 1rem 1.5rem;
      font-weight: 600;
      font-size: 1.1rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .card-header .actions {
      display: flex;
      gap: 10px;
    }
    
    .card-body {
      padding: 1.5rem;
    }
    
    .btn {
      padding: 8px 16px;
      border-radius: 4px;
      border: none;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }
    
    .btn-primary {
      background-color: var(--primary);
      color: var(--white);
    }
    
    .btn-primary:hover {
      background-color: #6a3dd3;
    }
    
    .btn-secondary {
      background-color: var(--secondary);
      color: var(--white);
    }
    
    .btn-secondary:hover {
      background-color: #e03b75;
    }
    
    .btn-outline {
      background-color: transparent;
      border: 1px solid var(--primary);
      color: var(--primary);
    }
    
    .btn-outline:hover {
      background-color: var(--primary-light);
    }
    
    .table-responsive {
      overflow-x: auto;
    }
    
    table {
      width: 100%;
      border-collapse: collapse;
    }
    
    th, td {
      padding: 12px 15px;
      text-align: left;
      border-bottom: 1px solid var(--gray);
    }
    
    th {
      background-color: var(--gray-light);
      font-weight: 600;
      color: var(--text-dark);
    }
    
    tr:nth-child(even) {
      background-color: #fafafa;
    }
    
    tr:hover {
      background-color: #f0f0f0;
    }
    
    .venue-info {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .venue-icon {
      background-color: var(--primary-light);
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--primary);
    }
    
    .venue-capacity {
      display: inline-block;
      padding: 3px 8px;
      border-radius: 12px;
      font-size: 0.85rem;
      font-weight: 500;
      background-color: var(--primary-light);
      color: var(--primary);
    }
    
    form {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 20px;
    }
    
    .form-group {
      margin-bottom: 15px;
    }
    
    label {
      display: block;
      margin-bottom: 5px;
      font-weight: 500;
      color: var(--text-dark);
    }
    
    input[type="text"],
    input[type="number"],
    textarea,
    select {
      width: 100%;
      padding: 10px 12px;
      border: 1px solid var(--gray);
      border-radius: 4px;
      font-size: 1rem;
      transition: border 0.3s ease;
    }
    
    input:focus,
    textarea:focus,
    select:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 2px var(--primary-light);
    }
    
    .buttons {
      grid-column: span 2;
      display: flex;
      justify-content: flex-end;
      gap: 10px;
      margin-top: 10px;
    }
    
    .form-full-width {
      grid-column: span 2;
    }
    
    .alert {
      padding: 12px 15px;
      border-radius: 4px;
      margin-bottom: 15px;
      display: none;
    }
    
    .alert-success {
      background-color: #e8f5e9;
      color: var(--success);
      border: 1px solid #c8e6c9;
    }
    
    .alert-error {
      background-color: #ffebee;
      color: var(--error);
      border: 1px solid #ffcdd2;
    }
    
    .venue-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 5px;
    }
    
    .tag {
      background-color: #f0f0f0;
      padding: 3px 8px;
      border-radius: 12px;
      font-size: 0.75rem;
    }
    
    .icon-button {
      background: none;
      border: none;
      cursor: pointer;
      padding: 5px;
      color: var(--text-light);
      transition: color 0.2s ease;
    }
    
    .icon-button:hover {
      color: var(--primary);
    }
    
    .actions-column {
      width: 100px;
    }
    
    /* Modal styles */
    .modal-backdrop {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0,0,0,0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      display: none;
    }
    
    .modal {
      background-color: var(--white);
      border-radius: 8px;
      width: 90%;
      max-width: 600px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.2);
    }
    
    .modal-header {
      padding: 15px 20px;
      border-bottom: 1px solid var(--gray);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .modal-title {
      font-size: 1.2rem;
      font-weight: 600;
    }
    
    .modal-close {
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      color: var(--text-light);
    }
    
    .modal-body {
      padding: 20px;
    }
    
    .modal-footer {
      padding: 15px 20px;
      border-top: 1px solid var(--gray);
      display: flex;
      justify-content: flex-end;
      gap: 10px;
    }
    
    @media (max-width: 768px) {
      form {
        grid-template-columns: 1fr;
      }
      
      .buttons {
        grid-column: 1;
      }
      
      .form-full-width {
        grid-column: 1;
      }
      
      .card-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 10px;
      }
      
      .card-header .actions {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <header>
    <div class="container header-content">
      <div class="logo">
        <i class="fas fa-music"></i>
        <span>Concert Management System</span>
      </div>
      <nav>
        <ul>
          <li><a href="#">Dashboard</a></li>
          <li><a href="#" class="active">Venues</a></li>
          <li><a href="#">Events</a></li>
          <li><a href="#">Artists</a></li>
          <li><a href="#">Tickets</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <div class="container">
    <h1 class="page-title">Venue Management</h1>
    
    <div id="alertContainer"></div>
    
    <div class="card">
      <div class="card-header">
        <span>All Venues</span>
        <div class="actions">
          <button id="refreshBtn" class="btn btn-outline">
            <i class="fas fa-sync-alt"></i> Refresh
          </button>
          <button id="addVenueBtn" class="btn btn-primary">
            <i class="fas fa-plus"></i> Add New Venue
          </button>
        </div>
      </div>
      <div class="card-body">
        <div class="table-responsive">
          <table id="venuesTable">
            <thead>
              <tr>
                <th>Venue ID</th>
                <th>Venue Details</th>
                <th>Location</th>
                <th>Capacity</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Add/Edit Venue Modal -->
  <div class="modal-backdrop" id="venueModal">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title" id="modalTitle">Add New Venue</h3>
        <button class="modal-close" id="closeModalBtn">&times;</button>
      </div>
      <div class="modal-body">
        <form id="venueForm">
          <input type="hidden" id="venueId" value="">
          
          <div class="form-group">
            <label for="name">Venue Name*</label>
            <input type="text" id="name" required placeholder="Enter venue name">
          </div>
          
          <div class="form-group">
            <label for="capacity">Capacity*</label>
            <input type="number" id="capacity" required min="1" placeholder="Maximum attendance capacity">
          </div>
          
          <div class="form-group">
            <label for="street">Street Address</label>
            <input type="text" id="street" placeholder="Enter street address">
          </div>
          
          <div class="form-group">
            <label for="city">City</label>
            <input type="text" id="city" placeholder="Enter city">
          </div>
          
          <div class="form-group">
            <label for="pinCode">Pin Code</label>
            <input type="number" id="pinCode" placeholder="Enter pin code">
          </div>
          
          <div class="form-group">
            <label for="venueType">Venue Type</label>
            <select id="venueType">
              <option value="">Select venue type</option>
              <option value="indoor">Indoor</option>
              <option value="outdoor">Outdoor</option>
              <option value="stadium">Stadium</option>
              <option value="theater">Theater</option>
              <option value="club">Club</option>
              <option value="arena">Arena</option>
            </select>
          </div>
          
          <div class="form-group form-full-width">
            <label for="description">Description</label>
            <textarea id="description" rows="3" placeholder="Enter venue description"></textarea>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-outline" id="cancelBtn">Cancel</button>
        <button type="button" class="btn btn-primary" id="saveVenueBtn">Save Venue</button>
      </div>
    </div>
  </div>

  <script>
    // DOM Elements
    const venuesTable = document.getElementById('venuesTable');
    const addVenueBtn = document.getElementById('addVenueBtn');
    const refreshBtn = document.getElementById('refreshBtn');
    const venueModal = document.getElementById('venueModal');
    const closeModalBtn = document.getElementById('closeModalBtn');
    const cancelBtn = document.getElementById('cancelBtn');
    const saveVenueBtn = document.getElementById('saveVenueBtn');
    const venueForm = document.getElementById('venueForm');
    const modalTitle = document.getElementById('modalTitle');
    const venueIdInput = document.getElementById('venueId');
    const alertContainer = document.getElementById('alertContainer');
    
    // Show alert message
    function showAlert(message, type = 'success') {
      const alert = document.createElement('div');
      alert.className = `alert alert-${type}`;
      alert.textContent = message;
      alert.style.display = 'block';
      
      alertContainer.innerHTML = '';
      alertContainer.appendChild(alert);
      
      setTimeout(() => {
        alert.style.opacity = '0';
        setTimeout(() => alertContainer.innerHTML = '', 300);
      }, 3000);
    }
    
    // Open modal
    function openModal(title = 'Add New Venue', isEdit = false) {
      modalTitle.textContent = title;
      venueModal.style.display = 'flex';
      if (!isEdit) {
        venueForm.reset();
        venueIdInput.value = '';
      }
    }
    
    // Close modal
    function handleCloseModal() {
      venueModal.style.display = 'none';
    }
    
    // Format address from venue data
    function formatAddress(venue) {
      const parts = [];
      if (venue.street) parts.push(venue.street);
      if (venue.city) parts.push(venue.city);
      if (venue.pin_code) parts.push(venue.pin_code);
      return parts.length > 0 ? parts.join(', ') : 'No address provided';
    }
    
    // Fetch all venues
    async function fetchVenues() {
      try {
        const res = await fetch('/api/venues');
        if (!res.ok) throw new Error('Failed to fetch venues');
        const venues = await res.json();
        
        const tbody = venuesTable.querySelector('tbody');
        tbody.innerHTML = '';
        
        if (venues.length === 0) {
          const emptyRow = document.createElement('tr');
          emptyRow.innerHTML = '<td colspan="5" style="text-align: center;">No venues found. Add a new venue to get started.</td>';
          tbody.appendChild(emptyRow);
          return;
        }
        
        venues.forEach(venue => {
          const tr = document.createElement('tr');
          
          tr.innerHTML = `
            <td>${venue.venue_id}</td>
            <td>
              <div class="venue-info">
                <div class="venue-icon">
                  <i class="fas fa-map-marker-alt"></i>
                </div>
                <div>
                  <strong>${venue.name}</strong>
                  <div class="venue-tags">
                    ${venue.venue_type ? `<span class="tag">${venue.venue_type}</span>` : ''}
                  </div>
                </div>
              </div>
            </td>
            <td>${formatAddress(venue)}</td>
            <td><span class="venue-capacity">${venue.capacity} seats</span></td>
            <td class="actions-column">
              <button class="icon-button edit-btn" data-id="${venue.venue_id}" title="Edit">
                <i class="fas fa-edit"></i>
              </button>
              <button class="icon-button view-btn" data-id="${venue.venue_id}" title="View Details">
                <i class="fas fa-eye"></i>
              </button>
            </td>
          `;
          
          tbody.appendChild(tr);
        });
        
        // Add event listeners to the buttons
        document.querySelectorAll('.edit-btn').forEach(btn => {
          btn.addEventListener('click', (e) => {
            const venueId = e.currentTarget.getAttribute('data-id');
            editVenue(venueId);
          });
        });
        
        document.querySelectorAll('.view-btn').forEach(btn => {
          btn.addEventListener('click', (e) => {
            const venueId = e.currentTarget.getAttribute('data-id');
            viewVenueDetails(venueId);
          });
        });
        
      } catch (err) {
        showAlert('Error loading venues: ' + err.message, 'error');
      }
    }

    // Edit venue
    async function editVenue(venueId) {
      try {
        const res = await fetch(`/api/venues/${venueId}`);
        if (!res.ok) throw new Error('Failed to fetch venue details');
        const venue = await res.json();
        
        // Populate form
        document.getElementById('venueId').value = venue.venue_id;
        document.getElementById('name').value = venue.name || '';
        document.getElementById('street').value = venue.street || '';
        document.getElementById('city').value = venue.city || '';
        document.getElementById('pinCode').value = venue.pin_code || '';
        document.getElementById('capacity').value = venue.capacity || '';
        document.getElementById('venueType').value = venue.venue_type || '';
        document.getElementById('description').value = venue.description || '';
        
        openModal('Edit Venue', true);
      } catch (err) {
        showAlert('Error fetching venue details: ' + err.message, 'error');
      }
    }

    // View venue details
    function viewVenueDetails(venueId) {
      // This would normally fetch the venue and show in a detailed view
      // For now, we'll just edit the venue
      editVenue(venueId);
    }

    // Save venue (create or update)
    async function saveVenue() {
      const venueId = document.getElementById('venueId').value;
      const name = document.getElementById('name').value.trim();
      const street = document.getElementById('street').value.trim();
      const city = document.getElementById('city').value.trim();
      const pinCode = document.getElementById('pinCode').value.trim();
      const capacity = document.getElementById('capacity').value.trim();
      const venueType = document.getElementById('venueType').value;
      const description = document.getElementById('description').value.trim();
      
      if (!name || !capacity) {
        showAlert('Name and capacity are required fields', 'error');
        return;
      }
      
      const venueData = {
        name,
        street,
        city,
        pin_code: pinCode ? parseInt(pinCode) : null,
        capacity: parseInt(capacity),
        venue_type: venueType,
        description
      };
      
      try {
        let url = '/api/venues';
        let method = 'POST';
        
        if (venueId) {
          url = `/api/venues/${venueId}`;
          method = 'PUT';
        }
        
        const res = await fetch(url, {
          method,
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(venueData)
        });
        
        if (!res.ok) {
          const errorData = await res.json();
          throw new Error(errorData.message || 'Failed to save venue');
        }
        
        showAlert(venueId ? 'Venue updated successfully' : 'Venue added successfully');
        handleCloseModal();
        fetchVenues();
      } catch (err) {
        showAlert('Error: ' + err.message, 'error');
      }
    }

    // Event Listeners
    addVenueBtn.addEventListener('click', () => openModal());
    closeModalBtn.addEventListener('click', handleCloseModal);
    cancelBtn.addEventListener('click', handleCloseModal);
    saveVenueBtn.addEventListener('click', saveVenue);
    refreshBtn.addEventListener('click', fetchVenues);
    
    // Close modal when clicking outside
    venueModal.addEventListener('click', (e) => {
      if (e.target === venueModal) {
        handleCloseModal();
      }
    });

    // Initialize
    document.addEventListener('DOMContentLoaded', fetchVenues);
  </script>
</body>
</html>